# KSentry

KSentry is a lightweight, serverless security and workflow orchestrator that serves as a final line of defense for your main branch by intercepting Pull Requests to perform critical tasks, such as Zero-Trust Secret Scanning which utilizes Gitleaks to identify and redact leaked credentials before they can merge.

## Deploy

### Deploy Gateway

[![Deploy with Vercel](https://vercel.com/button)](https://vercel.com/new/clone?repository-url=https://github.com/BiltuDas1/KSentry&template=fastapi)

- Deploy the code to platforms like Vercel
- Make sure to set the environment variable `SERVERLESS=true`

### Deploy Worker

- Build the Docker Image

  ```bash
  docker buildx build -f Dockerfile.worker -t <imagename>:<imagetag> .
  ```

- Push the docker to docker registry

  ```bash
  docker push <imagename>:<imagetag>
  ```

- Deploy it platforms like Render, make sure that it have longer request timeout like 2 minutes or so.

## Environment Variables

| Variable Name     | Description                                                                             | Scope           |
| ----------------- | --------------------------------------------------------------------------------------- | --------------- |
| `APP_PRIVATE_KEY` | RSA Private Key Generated by Github                                                     | Gateway, Worker |
| `APP_SECRET`      | Password inputted by the user for the app request, for authenticating source of request | Gateway, Worker |
| `APP_ID`          | Github App ID                                                                           | Gateway, Worker |
| `REDIS_URL`       | URI of the Redis Database                                                               | Gateway, Worker |
| `SERVERLESS`      | If true, it means it's the Gateway, otherwise it's worker                               | Gateway, Worker |
| `WORKER_URL`      | Webhook URL of the worker                                                               | Gateway         |
